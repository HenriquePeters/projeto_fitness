{% extends "base.html" %}
{% block content %}
<h2>Bem-vindo, {{ current_user.username }}! üéØ</h2>
<p>Aqui est√° um resumo r√°pido do seu progresso:</p>

<hr>
<h3>üçΩÔ∏è √öltima Refei√ß√£o</h3>
{% if last_meal %}
    <p><b>{{ last_meal.date.strftime('%d/%m/%Y %H:%M') }}</b> - {{ last_meal.description }} ({{ last_meal.calories }} kcal)</p>
{% else %}
    <p>Nenhuma refei√ß√£o registrada.</p>
{% endif %}

<hr>
<h3>üèãÔ∏è √öltimo Treino</h3>
{% if last_workout %}
    <p><b>{{ last_workout.date.strftime('%d/%m/%Y %H:%M') }}</b> - {{ last_workout.exercise }} | {{ last_workout.sets }}x{{ last_workout.reps }} ({{ last_workout.weight }} kg)</p>
{% else %}
    <p>Nenhum treino registrado.</p>
{% endif %}

<hr>
<h3>üìä √öltimo Progresso</h3>
{% if last_progress %}
    <p><b>{{ last_progress.date.strftime('%d/%m/%Y') }}</b> - Peso: {{ last_progress.weight }} kg 
    {% if last_progress.body_fat %}| Gordura: {{ last_progress.body_fat }}% {% endif %}
    {% if last_progress.height %}| Altura: {{ last_progress.height }} cm {% endif %}
    </p>
{% else %}
    <p>Nenhum progresso registrado.</p>
{% endif %}

<hr>
<h3>üìà Gr√°ficos de Evolu√ß√£o</h3>
<div style="width: 80%; margin: auto;">
    <canvas id="weightChart"></canvas>
    <canvas id="caloriesChart" style="margin-top:30px;"></canvas>
    <canvas id="workoutChart" style="margin-top:30px;"></canvas>
</div>

<script>
    // Peso
    const weightCtx = document.getElementById('weightChart').getContext('2d');
    new Chart(weightCtx, {
        type: 'line',
        data: {
            labels: {{ weight_labels|safe }},
            datasets: [{
                label: 'Peso (kg)',
                data: {{ weight_values|safe }},
                borderColor: 'blue',
                backgroundColor: 'lightblue',
                tension: 0.2
            }]
        }
    });

    // Calorias
    const caloriesCtx = document.getElementById('caloriesChart').getContext('2d');
    new Chart(caloriesCtx, {
        type: 'bar',
        data: {
            labels: {{ calories_labels|safe }},
            datasets: [{
                label: 'Calorias ingeridas',
                data: {{ calories_values|safe }},
                backgroundColor: 'orange'
            }]
        }
    });

    // Treinos
    const workoutCtx = document.getElementById('workoutChart').getContext('2d');
    new Chart(workoutCtx, {
        type: 'bar',
        data: {
            labels: {{ workout_labels|safe }},
            datasets: [{
                label: 'Treinos por semana',
                data: {{ workout_values|safe }},
                backgroundColor: 'green'
            }]
        }
    });
</script>
{% endblock %}
