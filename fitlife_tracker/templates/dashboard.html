{% extends "base.html" %}
{% block content %}
<h2 class="mb-4">Bem-vindo, {{ current_user.username }}!</h2>

<!-- Cards de resumo -->
<div class="row">
    <div class="col-md-4">
        <div class="card text-white bg-primary">
            <div class="card-body">
                <h5 class="card-title">Ãšltima RefeiÃ§Ã£o</h5>
                {% if last_meal %}
                    <p class="card-text">{{ last_meal.description }} ({{ last_meal.calories }} kcal)</p>
                    <small>{{ last_meal.date.strftime('%d/%m/%Y %H:%M') }}</small>
                {% else %}
                    <p class="card-text">Nenhuma refeiÃ§Ã£o registrada.</p>
                {% endif %}
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card text-white bg-success">
            <div class="card-body">
                <h5 class="card-title">Ãšltimo Treino</h5>
                {% if last_workout %}
                    <p class="card-text">{{ last_workout.exercise }} {{ last_workout.sets }}x{{ last_workout.reps }} ({{ last_workout.weight }} kg)</p>
                    <small>{{ last_workout.date.strftime('%d/%m/%Y %H:%M') }}</small>
                {% else %}
                    <p class="card-text">Nenhum treino registrado.</p>
                {% endif %}
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card text-white bg-warning">
            <div class="card-body">
                <h5 class="card-title">Ãšltimo Progresso</h5>
                {% if last_progress %}
                    <p class="card-text">Peso: {{ last_progress.weight }} kg | Gordura: {{ last_progress.body_fat or 'N/A' }}%</p>
                    <small>{{ last_progress.date.strftime('%d/%m/%Y') }}</small>
                {% else %}
                    <p class="card-text">Nenhum progresso registrado.</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- GrÃ¡ficos -->
<div class="mt-5">
    <h4>ðŸ“Š EvoluÃ§Ã£o</h4>
    <div class="row">
        <div class="col-md-6">
            <canvas id="weightChart"></canvas>
        </div>
        <div class="col-md-6">
            <canvas id="caloriesChart"></canvas>
        </div>
    </div>
    <div class="row mt-4">
        <div class="col-md-12">
            <canvas id="workoutChart"></canvas>
        </div>
    </div>
</div>

<script>
    // Peso
    new Chart(document.getElementById('weightChart').getContext('2d'), {
        type: 'line',
        data: {
            labels: {{ weight_labels|safe }},
            datasets: [{
                label: 'Peso (kg)',
                data: {{ weight_values|safe }},
                borderColor: '#0d6efd',
                backgroundColor: 'rgba(13,110,253,0.2)',
                tension: 0.3
            }]
        },
        options: { responsive:true }
    });

    // Calorias
    new Chart(document.getElementById('caloriesChart').getContext('2d'), {
        type: 'bar',
        data: {
            labels: {{ calories_labels|safe }},
            datasets: [{
                label: 'Calorias ingeridas',
                data: {{ calories_values|safe }},
                backgroundColor: '#fd7e14'
            }]
        },
        options: { responsive:true }
    });

    // Treinos
    new Chart(document.getElementById('workoutChart').getContext('2d'), {
        type: 'bar',
        data: {
            labels: {{ workout_labels|safe }},
            datasets: [{
                label: 'Treinos por semana',
                data: {{ workout_values|safe }},
                backgroundColor: '#198754'
            }]
        },
        options: { responsive:true }
    });
</script>
{% endblock %}
